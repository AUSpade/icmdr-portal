<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>iCmdr POC</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg:#0b1220;
  --panel:#111827;
  --panel2:#1f2937;
  --accent:#3b82f6;
  --text:#e5e7eb;
}

body {
  margin:0;
  font-family:system-ui,-apple-system;
  background:var(--bg);
  color:var(--text);
}

/* LOGIN */
.login {
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card {
  background:var(--panel);
  padding:24px;
  border-radius:12px;
  width:320px;
}

/* TOP BAR */
.topbar {
  height:52px;
  background:var(--panel);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 16px;
}
.hamburger {
  font-size:26px;
  cursor:pointer;
}

/* MENU */
.menu {
  position:fixed;
  top:52px;
  right:-260px;
  width:260px;
  height:calc(100% - 52px);
  background:var(--panel2);
  padding:16px;
  transition:0.25s;
}
.menu.open { right:0; }

.menu button {
  width:100%;
  padding:10px;
  margin-top:8px;
  background:var(--accent);
  border:none;
  border-radius:6px;
  color:white;
}

/* SCREENS */
.screen { display:none; padding:16px; }
.screen.active { display:block; }

input, select {
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:6px;
  border:none;
}

/* ADMIN LIST */
.member {
  background:var(--panel2);
  padding:12px;
  border-radius:8px;
  margin-bottom:10px;
}
.member button {
  margin-top:6px;
}

/* ROSTER GRID */
.shift {
  background:#1e293b;
  padding:10px;
  border-radius:6px;
  margin-bottom:6px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="loginScreen">
  <div class="card">
    <h2>Login</h2>
    <input id="loginUser" placeholder="Username">
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="loginErr" style="color:#f87171;display:none">Invalid login</p>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none">

  <div class="topbar">
    <strong>iCmdr – Morwell (POC)</strong>
    <div class="hamburger" onclick="toggleMenu()">☰</div>
  </div>

  <div class="menu" id="menu">
    <h3 id="menuUser"></h3>
    <button onclick="openScreen('profile')">Profile</button>
    <button onclick="openScreen('roster')">Roster</button>
    <div id="adminMenu"></div>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- PROFILE -->
  <div class="screen active" id="profile">
    <h2>Profile</h2>
    <p><strong>Name:</strong> <span id="pName"></span></p>
    <p><strong>Username:</strong> <span id="pUser"></span></p>
    <p><strong>Rank:</strong> <span id="pRank"></span></p>
    <p><strong>Member #:</strong> <span id="pNum"></span></p>

    <h3>This Month Availability</h3>
    <div id="profileRoster"></div>
  </div>

  <!-- ROSTER -->
  <div class="screen" id="roster">
    <h2>Unit Roster</h2>
    <div id="rosterView"></div>
  </div>

  <!-- ADMIN -->
  <div class="screen" id="admin">
    <h2>Members</h2>
    <div id="memberList"></div>
  </div>

</div>

<script>
const SHIFTS=["Tue-D","Tue-N","Wed-D","Wed-N","Thu-D","Thu-N","Fri-D","Fri-N","Sat-D","Sat-N"];

const RANK_RULES={
  "Section Leader":["Member","Section Leader"],
  "Deputy Controller":["Member","Section Leader"],
  "Controller":["Member","Section Leader","Deputy Controller"],
  "Staff":["Member","Section Leader","Deputy Controller","Controller"],
  "Super Admin":["Member","Section Leader","Deputy Controller","Controller","Staff","Super Admin"]
};

let users=JSON.parse(localStorage.getItem("users"))||{
  admin:{
    username:"admin",
    name:"Aaron Robbins",
    pass:"admin",
    rank:"Super Admin",
    num:"33",
    roster:{}
  }
};

let currentUser="";

function save(){ localStorage.setItem("users",JSON.stringify(users)); }

function toggleMenu(){ menu.classList.toggle("open"); }

function openScreen(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  toggleMenu();
  if(id==="admin") renderAdmin();
  if(id==="roster") renderRoster();
}

function login(){
  const u=loginUser.value,p=loginPass.value;
  const user=Object.values(users).find(x=>x.username===u && x.pass===p);
  if(user){
    currentUser=user.username;
    menuUser.innerText=`${user.num} ${user.name}`;
    pName.innerText=user.name;
    pUser.innerText=user.username;
    pRank.innerText=user.rank;
    pNum.innerText=user.num;
    loginScreen.style.display="none";
    app.style.display="block";
    if(user.rank!=="Member"){
      adminMenu.innerHTML='<button onclick="openScreen(`admin`)">Admin</button>';
    }
    renderProfileRoster();
  } else loginErr.style.display="block";
}

function logout(){
  currentUser="";
  app.style.display="none";
  loginScreen.style.display="flex";
  menu.classList.remove("open");
}

function renderAdmin(){
  const me=Object.values(users).find(u=>u.username===currentUser);
  memberList.innerHTML="";
  Object.values(users).forEach(u=>{
    const canEdit = me.rank!=="Section Leader";
    memberList.innerHTML+=`
      <div class="member">
        <strong>${u.num} ${u.name}</strong><br>
        Rank: ${u.rank}<br>
        ${canEdit?`<button onclick="editUser('${u.username}')">Edit</button>`:""}
      </div>`;
  });
}

function editUser(username){
  const me=Object.values(users).find(u=>u.username===currentUser);
  const u=Object.values(users).find(x=>x.username===username);
  const allowed=RANK_RULES[me.rank]||[];

  memberList.innerHTML=`
    <div class="member">
      Name <input value="${u.name}" onchange="u.name=this.value">
      Member # <input value="${u.num}" onchange="u.num=this.value">
      Username <input value="${u.username}" onchange="u.username=this.value">
      Password <input value="${u.pass}" onchange="u.pass=this.value">
      Rank
      <select onchange="u.rank=this.value">
        ${allowed.map(r=>`<option ${u.rank===r?"selected":""}>${r}</option>`).join("")}
      </select>
      <button onclick="save();renderAdmin()">Save</button>
    </div>`;
}

function renderProfileRoster(){
  profileRoster.innerHTML="";
  SHIFTS.forEach(s=>{
    profileRoster.innerHTML+=`<div class="shift">${s}: ${users[currentUser].roster[s]||"—"}</div>`;
  });
}

function renderRoster(){
  rosterView.innerHTML="";
  Object.values(users).forEach(u=>{
    rosterView.innerHTML+=`<div class="member"><strong>${u.num} ${u.name}</strong></div>`;
  });
}
</script>

</body>
</html>
